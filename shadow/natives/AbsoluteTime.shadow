/**
 * This is a managed implementation of the `timespec` struct in C. This class is
 * used by the {@code Signaler} class to specify timeouts.
 *
 * @author Claude Abounegm
 * @seeDoc shadow:natives@Signaler
 */
locked class shadow:natives@
	AbsoluteTime
{
	private native readonly setAbsoluteTime(Pointer time, int sec, int nsec) => ();
	private native readonly get handleSize() => (int);
	
	get Pointer ptr;
	
	public create(TimeSpan ts)
	{
		ptr = Pointer:create(this->handleSize);

		// calculate the absolute time
		var absTime = ts + Time->epochNow;
		
		// set the data of the struct natively
		setAbsoluteTime(ptr, cast<int>(absTime->totalSeconds), absTime->nanoSeconds);
	}
	
	public readonly free() => ()
	{
		ptr.free();
	}
}